{% extends "base.html" %}

{% block title %}{{ report.title }} - Taylor Wimpey{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
    <a href="javascript:history.back()" class="back-button" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; background: var(--bg-white); color: var(--text-dark); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--border-color);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
    </a>
    <div>
        <h1 class="page-title" style="margin: 0;">{{ report.title }}</h1>
        <p style="color: var(--text-light); margin-top: 0.25rem; font-size: 0.95rem;">{{ report.description }}</p>
    </div>
</div>

<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 1.5rem; border-radius: 12px; margin-bottom: 2rem; color: white; display: flex; align-items: center; gap: 1rem;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <div>
        <strong>Proof of Concept</strong> - This is a demo version showing mock data.
    </div>
</div>

<div class="metrics-grid">
    {% for metric in report.metrics %}
    <div class="metric-card">
        <div class="metric-label">{{ metric.label }}</div>
        <div class="metric-value">{{ metric.value }}</div>
        <div class="metric-change {% if metric.change.startswith('+') %}positive{% else %}negative{% endif %}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                {% if metric.change.startswith('+') %}
                <polyline points="18 15 12 9 6 15"></polyline>
                {% else %}
                <polyline points="6 9 12 15 18 9"></polyline>
                {% endif %}
            </svg>
            {{ metric.change }} vs last period
        </div>
    </div>
    {% endfor %}
</div>

<div class="chart-section">
    <h3 style="margin-bottom: 1rem; color: var(--text-dark);">Trend Analysis</h3>
    <canvas id="trendChart" style="max-height: 300px;"></canvas>
</div>

<div class="insights-section">
    <h3 style="margin-bottom: 1rem; color: var(--text-dark);">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 16v-4"></path>
            <path d="M12 8h.01"></path>
        </svg>
        Key Insights
    </h3>
    <div class="insights-grid">
        {% for insight in report.insights %}
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 11 12 14 22 4"></polyline>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
            </div>
            <div>{{ insight }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
    <button class="action-btn primary">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Export Report
    </button>
    <button class="action-btn secondary">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        Schedule Report
    </button>
    <button class="action-btn secondary">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
            <polyline points="16 6 12 2 8 6"></polyline>
            <line x1="12" y1="2" x2="12" y2="15"></line>
        </svg>
        Share
    </button>
</div>

<style>
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.metric-card {
    background: var(--bg-white);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.metric-label {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.metric-change {
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.metric-change.positive {
    color: #10b981;
}

.metric-change.negative {
    color: #ef4444;
}

.chart-section {
    background: var(--bg-white);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    margin-bottom: 2rem;
}

.insights-section {
    background: var(--bg-white);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid var(--border-color);
}

.insights-grid {
    display: grid;
    gap: 1rem;
}

.insight-card {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-light);
    border-radius: 8px;
    border-left: 3px solid var(--primary-color);
    transition: all 0.3s ease;
}

.insight-card:hover {
    background: #f0fdf4;
    border-left-color: #10b981;
}

.insight-icon {
    width: 40px;
    height: 40px;
    background: var(--bg-white);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--primary-color);
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.95rem;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.action-btn.primary {
    background: var(--primary-color);
    color: white;
}

.action-btn.primary:hover {
    background: var(--brand-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(204, 43, 74, 0.3);
}

.action-btn.secondary {
    background: var(--bg-white);
    color: var(--text-dark);
    border: 1px solid var(--border-color);
}

.action-btn.secondary:hover {
    background: var(--bg-light);
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.back-button:hover {
    background: var(--bg-light);
    transform: translateX(-2px);
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
var ctx = document.getElementById('trendChart').getContext('2d');
var reportLabels = {{ report.chart_data.labels | tojson | safe }};
var reportValues = {{ report.chart_data.values | tojson | safe }};

var chartData = {
    labels: reportLabels,
    datasets: [{
        label: 'Trend',
        data: reportValues,
        borderColor: 'rgb(204, 43, 74)',
        backgroundColor: 'rgba(204, 43, 74, 0.1)',
        tension: 0.4,
        fill: true,
        pointRadius: 5,
        pointHoverRadius: 7,
        pointBackgroundColor: 'rgb(204, 43, 74)',
        pointBorderColor: '#fff',
        pointBorderWidth: 2
    }]
};

var config = {
    type: 'line',
    data: chartData,
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                cornerRadius: 8
            }
        },
        scales: {
            y: {
                beginAtZero: false,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
};

new Chart(ctx, config);

document.querySelectorAll('.action-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
        var action = this.textContent.trim();
        alert(action + ' functionality will be implemented in production version.');
    });
});
</script>
{% endblock %}